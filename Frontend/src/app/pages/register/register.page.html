<ion-header>
  <ion-toolbar>
    <ion-title>Inscription</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
    <ion-list>
      <!-- Name -->
      <ion-item>
        <ion-icon slot="start" name="person"></ion-icon>
        <ion-input
          label="Nom"
          labelPlacement="stacked"
          formControlName="nom"
          placeholder="Votre nom">
        </ion-input>
      </ion-item>
      <ion-note color="danger" *ngIf="nom?.touched && nom?.invalid">
        Nom requis (min 2 caractères).
      </ion-note>

      <!-- Email -->
      <ion-item>
        <ion-icon slot="start" name="mail"></ion-icon>
        <ion-input
          type="email"
          label="Email"
          labelPlacement="stacked"
          formControlName="email"
          placeholder="you@example.com">
        </ion-input>
      </ion-item>
      <ion-note color="danger" *ngIf="email?.touched && email?.invalid">
        Email valide requis.
      </ion-note>

      <!-- Password (uses 'pwd' to match backend register) -->
      <ion-item>
        <ion-icon slot="start" name="lock-closed"></ion-icon>
        <ion-input
          [type]="showPwd ? 'text' : 'password'"
          label="Mot de passe"
          labelPlacement="stacked"
          formControlName="pwd"
          placeholder="••••••••">
        </ion-input>
        <ion-button fill="clear" size="small" type="button" (click)="showPwd = !showPwd">
          {{ showPwd ? 'Masquer' : 'Afficher' }}
        </ion-button>
      </ion-item>
      <ion-note color="danger" *ngIf="pwd?.touched && pwd?.invalid">
        Mot de passe (min 6 caractères).
      </ion-note>

      <!-- Role -->
      <ion-item>
        <ion-label position="stacked">Rôle</ion-label>
        <ion-select formControlName="role" interface="popover">
          <ion-select-option *ngFor="let r of roleOptions" [value]="r">{{ r }}</ion-select-option>
        </ion-select>
      </ion-item>

      <!-- Speciality (PRO only) -->
      <ion-item *ngIf="isPro()">
        <ion-icon slot="start" name="briefcase"></ion-icon>
        <ion-input
          label="Spécialité"
          labelPlacement="stacked"
          formControlName="specialite"
          placeholder="Cardiologue, Dentiste...">
        </ion-input>
      </ion-item>
      <ion-note color="danger" *ngIf="isPro() && specialite?.touched && specialite?.invalid">
        Spécialité requise pour un professionnel (min 2 caractères).
      </ion-note>
    </ion-list>

    <!-- Backend error -->
    <ion-note color="danger" *ngIf="errorMsg" class="ion-margin-top">{{ errorMsg }}</ion-note>

    <!-- Submit -->
    <ion-button expand="block" class="ion-margin-top" type="submit">
      <ion-icon slot="start" name="person-add"></ion-icon>
      Créer un compte
    </ion-button>

    <!-- Navigate to login: MUST be type="button" so the form doesn't submit -->
    <ion-button expand="block" fill="clear" type="button" (click)="goLogin()"
                routerDirection="back">
      J'ai déjà un compte
    </ion-button>
  </form>
</ion-content>
